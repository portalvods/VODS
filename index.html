<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal VOD - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        :root { --bg-dark: #090e1a; --card-dark: #111827; --accent: #3b82f6; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: #f3f4f6; margin: 0; }
        .glass { background: rgba(17, 24, 39, 0.8); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); }
        .status-badge { font-size: 10px; font-weight: 800; padding: 4px 12px; border-radius: 20px; text-transform: uppercase; }
        .status-pendente { background: #fef3c7; color: #92400e; }
        .status-analise { background: #dbeafe; color: #1e40af; }
        .status-concluido { background: #dcfce7; color: #166534; }
        .status-rejeitado { background: #fee2e2; color: #991b1b; }
        .input-dark { background: #1f2937; border: 1px solid #374151; color: white; transition: all 0.3s; }
        .input-dark:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); outline: none; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .card-animate { animation: fadeInUp 0.4s ease forwards; }
        .swal2-popup { background: #111827 !important; color: #fff !important; border-radius: 24px !important; border: 1px solid rgba(255,255,255,0.1) !important; }
    </style>
</head>
<body class="p-4 md:p-10">

    <script>
        const DATABASE_URL = 'https://vods-23763-default-rtdb.firebaseio.com/pedidos.json';
        const API_KEY_TMDB = '9e64130cb366f23a3398f4f7c8e982c0';
        const ADMIN_PASSWORD = 'vods123@';
        let currentItem = {};
        let searchMode = 'movie';
    </script>

    <header class="container mx-auto flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
        <div class="text-center md:text-left">
            <h1 class="text-4xl font-black tracking-tighter text-blue-500">PORTAL<span class="text-white">VOD</span></h1>
            <p class="text-slate-500 font-medium">Gerenciamento de Conte√∫do</p>
        </div>
        <nav class="flex gap-2 glass p-1.5 rounded-2xl shadow-2xl">
            <button onclick="showPage('cliente')" class="px-6 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-800 transition">In√≠cio</button>
            <button onclick="showPage('status')" class="px-6 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-800 transition">Meus Pedidos</button>
            <button onclick="checkAdminPassword()" class="px-6 py-2.5 rounded-xl text-sm font-bold bg-blue-600 hover:bg-blue-700 transition shadow-lg">Admin</button>
        </nav>
    </header>

    <main id="page-cliente" class="container mx-auto max-w-6xl">
        <div class="glass p-8 rounded-[32px] mb-12 shadow-2xl">
            <div class="flex gap-6 mb-8 border-b border-slate-800 pb-4">
                <button onclick="setSearchMode('movie')" id="btn-movie" class="text-blue-500 font-bold border-b-2 border-blue-500 pb-2">Filmes & S√©ries</button>
                <button onclick="setSearchMode('tv')" id="btn-tv" class="text-slate-500 font-bold pb-2">Canais ao Vivo</button>
            </div>
            <div class="relative"><i class="fas fa-search absolute left-5 top-5 text-slate-500"></i>
                <input type="text" id="searchInput" onkeyup="handleSearch()" placeholder="Pesquisar..." class="w-full input-dark p-5 pl-14 rounded-2xl">
            </div>
        </div>
        <div id="grid-content" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8"></div>
    </main>

    <main id="page-status" class="container mx-auto max-w-2xl hidden">
        <div class="glass p-10 rounded-[32px]">
            <h2 class="text-3xl font-black mb-8">Status do Pedido</h2>
            <div class="flex gap-3 mb-8">
                <input type="email" id="trackEmail" placeholder="Seu e-mail" class="flex-1 input-dark p-4 rounded-2xl">
                <button onclick="trackRequests()" class="bg-blue-600 px-8 rounded-2xl font-bold">Buscar</button>
            </div>
            <div id="track-results" class="space-y-5"></div>
        </div>
    </main>

    <main id="page-admin" class="container mx-auto max-w-6xl hidden">
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="glass p-6 rounded-3xl border-l-4 border-blue-500">
                <p class="text-slate-400 text-xs font-bold uppercase">Total</p>
                <h3 id="stat-total" class="text-2xl font-black">0</h3>
            </div>
            <div class="glass p-6 rounded-3xl border-l-4 border-yellow-500">
                <p class="text-slate-400 text-xs font-bold uppercase">Em An√°lise</p>
                <h3 id="stat-analise" class="text-2xl font-black text-yellow-500">0</h3>
            </div>
            <div class="glass p-6 rounded-3xl border-l-4 border-green-500">
                <p class="text-slate-400 text-xs font-bold uppercase">Conclu√≠dos</p>
                <h3 id="stat-concluido" class="text-2xl font-black text-green-500">0</h3>
            </div>
            <div class="glass p-6 rounded-3xl border-l-4 border-red-500">
                <p class="text-slate-400 text-xs font-bold uppercase">Rejeitados</p>
                <h3 id="stat-rejeitado" class="text-2xl font-black text-red-500">0</h3>
            </div>
        </div>

        <div class="glass rounded-[32px] overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-900/60 text-slate-500 uppercase text-[10px] font-black">
                    <tr><th class="p-6">Conte√∫do</th><th class="p-6">Solicitante</th><th class="p-6">Status</th><th class="p-6 text-center">A√ß√µes</th></tr>
                </thead>
                <tbody id="admin-table" class="divide-y divide-slate-800"></tbody>
            </table>
        </div>
    </main>

    <div id="modal" class="fixed inset-0 bg-black/90 hidden flex items-center justify-center p-4 z-50 backdrop-blur-xl">
        <div class="glass rounded-[40px] max-w-md w-full p-10">
            <div id="modal-poster" class="w-32 h-44 bg-slate-800 rounded-3xl mb-6 mx-auto overflow-hidden border border-slate-700"></div>
            <h3 class="text-2xl font-black text-center mb-8" id="modalTitle"></h3>
            <div class="space-y-4">
                <input type="text" id="userName" placeholder="Nome" class="w-full input-dark p-4 rounded-2xl">
                <input type="email" id="userEmail" placeholder="E-mail" class="w-full input-dark p-4 rounded-2xl">
                <select id="requestType" class="w-full input-dark p-4 rounded-2xl">
                    <option value="Adi√ß√£o">üé¨ Solicitar Adi√ß√£o</option>
                    <option value="Conserto">üõ†Ô∏è Relatar Problema</option>
                    <option value="Atualiza√ß√£o">üîÑ Solicitar Atualiza√ß√£o</option>
                </select>
                <textarea id="userObs" placeholder="Obs..." class="w-full input-dark p-4 rounded-2xl h-24"></textarea>
                <button id="btnEnviar" onclick="saveToFirebase()" class="w-full py-5 bg-blue-600 rounded-[24px] font-black">ENVIAR</button>
                <button onclick="closeModal()" class="w-full text-slate-500 font-bold mt-4">VOLTAR</button>
            </div>
        </div>
    </div>

    <script>
        function showPage(page) {
            document.querySelectorAll('main').forEach(m => m.classList.add('hidden'));
            document.getElementById(`page-${page}`).classList.remove('hidden');
            if(page === 'admin') loadAdmin();
        }

        function setSearchMode(mode) {
            searchMode = mode;
            document.getElementById('btn-movie').className = mode === 'movie' ? 'text-blue-500 font-bold border-b-2 border-blue-500 pb-2' : 'text-slate-500 font-bold pb-2';
            document.getElementById('btn-tv').className = mode === 'tv' ? 'text-blue-500 font-bold border-b-2 border-blue-500 pb-2' : 'text-slate-500 font-bold pb-2';
            document.getElementById('grid-content').innerHTML = '';
        }

        async function searchTMDB() {
            const q = document.getElementById('searchInput').value;
            if(q.length < 3) return;
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY_TMDB}&language=pt-BR&query=${q}`);
            const data = await res.json();
            renderGrid(data.results.filter(i => i.poster_path).map(i => ({ name: (i.title || i.name).replace(/'/g, ""), img: `https://image.tmdb.org/t/p/w500${i.poster_path}` })));
        }

        function handleSearch() { if (searchMode === 'movie') searchTMDB(); else searchCanais(); }
        
        function searchCanais() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            if(q.length < 2) return;
            renderGrid([{ name: `Canal: ${q}`, img: 'https://cdn-icons-png.flaticon.com/512/716/716429.png' }]);
        }

        function renderGrid(items) {
            const grid = document.getElementById('grid-content');
            grid.innerHTML = items.map((item, idx) => `
                <div class="glass p-4 rounded-[32px] group card-animate" style="animation-delay: ${idx * 0.05}s">
                    <img src="${item.img}" class="w-full h-64 object-cover rounded-2xl mb-4 group-hover:scale-105 transition duration-500">
                    <h4 class="font-bold text-sm truncate text-slate-200 mb-3">${item.name}</h4>
                    <button onclick="openModal('${item.name}', '${item.img}')" class="w-full bg-slate-800 hover:bg-blue-600 py-2 rounded-xl text-[10px] font-black uppercase transition">Solicitar</button>
                </div>`).join('');
        }

        function openModal(name, img) {
            currentItem = { name, img };
            document.getElementById('modalTitle').innerText = name;
            document.getElementById('modal-poster').innerHTML = `<img src="${img}" class="w-full h-full object-cover">`;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        async function saveToFirebase() {
            const user = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim().toLowerCase();
            if(!user || !email) return Swal.fire('Erro', 'Preencha nome e e-mail', 'warning');

            const btn = document.getElementById('btnEnviar');
            btn.disabled = true;
            btn.innerText = "VERIFICANDO...";

            const resData = await fetch(DATABASE_URL);
            const data = await resData.json();
            const agora = new Date().getTime();

            if (data) {
                const pedidos = Object.values(data).filter(p => p.email === email);
                if (pedidos.length > 0) {
                    const ultimo = pedidos.sort((a, b) => b.timestamp - a.timestamp)[0];
                    if (agora - ultimo.timestamp < 24 * 60 * 60 * 1000) {
                        Swal.fire('Aviso', 'Apenas 1 pedido por dia por e-mail.', 'error');
                        btn.disabled = false; btn.innerText = "ENVIAR";
                        return;
                    }
                }
            }

            await fetch(DATABASE_URL, { method: 'POST', body: JSON.stringify({ ...currentItem, user, email, type: document.getElementById('requestType').value, obs: document.getElementById('userObs').value, status: 'Pendente', date: new Date().toLocaleString('pt-BR'), timestamp: agora }) });
            Swal.fire('Sucesso', 'Pedido enviado!', 'success');
            btn.disabled = false; btn.innerText = "ENVIAR";
            closeModal();
        }

        async function trackRequests() {
            const email = document.getElementById('trackEmail').value.trim().toLowerCase();
            const res = await fetch(DATABASE_URL);
            const data = await res.json();
            const container = document.getElementById('track-results');
            container.innerHTML = "";
            if(!data) return;
            Object.values(data).reverse().forEach(p => {
                if(p.email === email) {
                    let feedback = p.motivo ? `<button onclick="Swal.fire('Resposta', '${p.motivo.replace(/'/g, "\\'")}', 'info')" class="text-[10px] text-blue-400 font-bold underline mt-2 block uppercase">Ver Resposta</button>` : '';
                    container.innerHTML += `<div class="glass p-5 rounded-3xl flex items-center gap-5 card-animate"><img src="${p.img}" class="w-14 h-20 rounded-xl object-cover"><div class="flex-1"><b class="text-white">${p.name}</b><br><span class="text-slate-500 text-xs">${p.date}</span></div><div class="text-right"><span class="status-badge status-${p.status.toLowerCase().replace(/ /g, '').replace('√°','a')}">${p.status}</span>${feedback}</div></div>`;
                }
            });
        }

        async function loadAdmin() {
            const res = await fetch(DATABASE_URL);
            const data = await res.json();
            const table = document.getElementById('admin-table');
            table.innerHTML = "";
            let stats = { total: 0, analise: 0, concluido: 0, rejeitado: 0 };
            if(!data) return updateStats(stats);
            Object.keys(data).reverse().forEach(id => {
                const p = data[id];
                stats.total++;
                if(p.status === 'Em An√°lise') stats.analise++;
                if(p.status === 'Conclu√≠do') stats.concluido++;
                if(p.status === 'Rejeitado') stats.rejeitado++;
                table.innerHTML += `
                    <tr class="hover:bg-white/5">
                        <td class="p-6 flex gap-4 items-center"><img src="${p.img}" class="w-12 h-16 rounded-xl object-cover"><div><p class="font-bold text-sm text-white">${p.name}</p><span class="text-[9px] text-blue-500 font-black">${p.type}</span></div></td>
                        <td class="p-6 text-xs text-slate-400"><b>${p.user}</b><br>${p.email}</td>
                        <td class="p-6"><span class="status-badge status-${p.status.toLowerCase().replace(/ /g, '').replace('√°','a')}">${p.status}</span></td>
                        <td class="p-6 text-center">
                            <select onchange="handleStatusChange('${id}', this.value)" class="text-[10px] p-2 bg-slate-800 rounded-xl outline-none mr-2">
                                <option value="Pendente" ${p.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                <option value="Em An√°lise" ${p.status === 'Em An√°lise' ? 'selected' : ''}>An√°lise</option>
                                <option value="Conclu√≠do" ${p.status === 'Conclu√≠do' ? 'selected' : ''}>Conclu√≠do</option>
                                <option value="Rejeitado" ${p.status === 'Rejeitado' ? 'selected' : ''}>Rejeitado</option>
                            </select>
                            <button onclick="deletePedido('${id}')" class="text-slate-500 hover:text-red-500 transition"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    </tr>`;
            });
            updateStats(stats);
        }

        function updateStats(s) {
            document.getElementById('stat-total').innerText = s.total;
            document.getElementById('stat-analise').innerText = s.analise;
            document.getElementById('stat-concluido').innerText = s.concluido;
            document.getElementById('stat-rejeitado').innerText = s.rejeitado;
        }

        async function handleStatusChange(id, newStatus) {
            let motivo = "";
            if(newStatus === 'Rejeitado') {
                const { value: text } = await Swal.fire({ title: 'Motivo', input: 'select', inputOptions: { '1': 'J√° existe', '2': 'Pouca relev√¢ncia', '3': 'Sem m√≠dia' } });
                if(text === '1') motivo = "J√° existe no servidor.";
                else if(text === '2') motivo = "Pouca relev√¢ncia.";
                else if(text === '3') motivo = "Sem m√≠dia no momento.";
            } else if(newStatus === 'Conclu√≠do') motivo = "Pedido atendido!";
            await fetch(DATABASE_URL.replace('.json', `/${id}.json`), { method: 'PATCH', body: JSON.stringify({ status: newStatus, motivo: motivo }) });
            loadAdmin();
        }

        async function deletePedido(id) {
            const r = await Swal.fire({ title: 'Excluir?', icon: 'warning', showCancelButton: true, confirmButtonColor: '#d33', confirmButtonText: 'Sim!', cancelButtonText: 'N√£o' });
            if (r.isConfirmed) { await fetch(DATABASE_URL.replace('.json', `/${id}.json`), { method: 'DELETE' }); loadAdmin(); }
        }

        function checkAdminPassword() {
            Swal.fire({ title: 'Admin', input: 'password', showCancelButton: true }).then((r) => { if(r.value === ADMIN_PASSWORD) showPage('admin'); });
        }
    </script>
</body>
</html>