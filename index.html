<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOLICITAPLAY - Sistema de Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .poster-card:hover .overlay { opacity: 1; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen">

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <h1 class="text-xl font-black text-blue-600 tracking-tighter cursor-pointer" onclick="showPage('cliente')">SOLICITA<span class="text-gray-800">PLAY</span></h1>
            <div class="space-x-4">
                <button onclick="showPage('cliente')" class="text-sm font-bold uppercase hover:text-blue-600">Site</button>
                <button onclick="checkAdminPassword()" class="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700 transition">Painel Admin</button>
            </div>
        </div>
    </nav>

    <main id="page-cliente" class="container mx-auto px-4 py-8">
        <div class="max-w-2xl mx-auto mb-10 text-center">
            <h2 class="text-3xl font-bold mb-4">O que voc√™ quer assistir?</h2>
            <div class="relative">
                <input type="text" id="searchInput" onkeyup="searchTMDB()" placeholder="Busque pelo nome do filme ou s√©rie..." 
                    class="w-full pl-12 pr-4 py-4 border-none shadow-xl rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none">
                <i class="fas fa-search absolute left-5 top-5 text-gray-400"></i>
            </div>
        </div>
        
        <div id="grid-content" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
        </div>
    </main>

    <main id="page-admin" class="container mx-auto px-4 py-8 hidden">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-bold">Gerenciar Solicita√ß√µes</h2>
            <div class="space-x-4">
                <button onclick="showPage('cliente')" class="text-gray-500 hover:underline">Sair do Painel</button>
                <button onclick="clearAll()" class="text-red-500 text-sm hover:underline">Limpar tudo</button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead class="bg-gray-50 text-gray-400 text-xs uppercase font-medium">
                    <tr>
                        <th class="p-4">Conte√∫do</th>
                        <th class="p-4">Solicitante</th>
                        <th class="p-4">Tipo/Obs</th>
                        <th class="p-4">Status</th>
                        <th class="p-4 text-center">A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="admin-table" class="divide-y divide-gray-100"></tbody>
            </table>
        </div>
    </main>

    <div id="modal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center p-4 z-[60] backdrop-blur-sm">
        <div class="bg-white rounded-3xl max-w-md w-full p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div id="modal-poster" class="w-24 h-36 bg-gray-200 rounded-lg mb-4 mx-auto overflow-hidden shadow-lg"></div>
            <h3 class="text-2xl font-bold text-center mb-1" id="modalTitle">Nome do Filme</h3>
            <p id="modalInfo" class="text-center text-gray-500 text-sm mb-6"></p>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">Seu Nome</label>
                    <input type="text" id="userName" placeholder="Ex: Jo√£o da Silva" class="w-full p-3 bg-gray-50 border rounded-xl outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">Seu E-mail (Obrigat√≥rio)</label>
                    <input type="email" id="userEmail" placeholder="exemplo@email.com" class="w-full p-3 bg-gray-50 border rounded-xl outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">O que deseja?</label>
                    <select id="requestType" class="w-full p-3 bg-gray-50 border rounded-xl outline-none">
                        <option value="Adi√ß√£o">üé¨ Solicitar Adi√ß√£o</option>
                        <option value="Conserto">üõ†Ô∏è Reportar Erro</option>
                        <option value="Atualiza√ß√£o">üîÑ Pedir Atualiza√ß√£o</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase">Observa√ß√µes</label>
                    <textarea id="userObs" rows="2" placeholder="Detalhes extras..." class="w-full p-3 bg-gray-50 border rounded-xl outline-none focus:border-blue-500"></textarea>
                </div>
                <button onclick="saveRequest()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition">Enviar Solicita√ß√£o</button>
                <button onclick="closeModal()" class="w-full text-gray-400 text-sm font-medium">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '9e64130cb366f23a3398f4f7c8e982c0';
        const ADMIN_PASSWORD = '1234'; 
        let currentItem = {};

        function checkAdminPassword() {
            const pass = prompt("Digite a senha de administrador:");
            if (pass === ADMIN_PASSWORD) {
                showPage('admin');
            } else if (pass !== null) {
                alert("Senha incorreta!");
            }
        }

        function showPage(page) {
            document.getElementById('page-cliente').classList.toggle('hidden', page !== 'cliente');
            document.getElementById('page-admin').classList.toggle('hidden', page !== 'admin');
            if(page === 'admin') renderAdminTable();
        }

        async function searchTMDB() {
            const query = document.getElementById('searchInput').value;
            if(query.length < 3) return;
            const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&language=pt-BR&query=${query}`);
            const data = await res.json();
            
            const grid = document.getElementById('grid-content');
            grid.innerHTML = '';
            data.results.forEach(item => {
                if(!item.poster_path) return;
                const name = (item.title || item.name).replace(/'/g, "");
                const poster = `https://image.tmdb.org/t/p/w500${item.poster_path}`;
                grid.innerHTML += `
                    <div class="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition transform hover:-translate-y-1">
                        <img src="${poster}" class="w-full h-64 object-cover">
                        <div class="p-3 text-center">
                            <h4 class="font-bold text-sm truncate mb-2">${name}</h4>
                            <button onclick="openModal('${name}', '${item.id}', '${poster}')" 
                                class="w-full bg-blue-600 text-white py-2 rounded-lg text-xs font-bold hover:bg-blue-700">
                                SOLICITAR
                            </button>
                        </div>
                    </div>`;
            });
        }

        function openModal(name, id, img) {
            currentItem = { name, id, img };
            document.getElementById('modalTitle').innerText = name;
            document.getElementById('modalInfo').innerText = "ID: " + id;
            document.getElementById('modal-poster').innerHTML = `<img src="${img}" class="w-full h-full object-cover">`;
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        function saveRequest() {
            const user = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim().toLowerCase();
            const type = document.getElementById('requestType').value;
            const obs = document.getElementById('userObs').value;
            
            // Valida√ß√µes b√°sicas
            if(!user || !email) return alert("Por favor, preencha seu nome e e-mail.");
            if(!email.includes('@')) return alert("Por favor, insira um e-mail v√°lido.");

            const pedidos = JSON.parse(localStorage.getItem('meus_pedidos') || '[]');
            
            // L√ìGICA DE LIMITE POR E-MAIL (24h)
            const agora = new Date().getTime();
            const UM_DIA = 24 * 60 * 60 * 1000;

            const ultimoPedido = pedidos.reverse().find(p => p.email === email);
            pedidos.reverse(); 

            if (ultimoPedido) {
                const tempoPassado = agora - ultimoPedido.timestamp;
                if (tempoPassado < UM_DIA) {
                    const horasRestantes = Math.ceil((UM_DIA - tempoPassado) / (1000 * 60 * 60));
                    return alert(`O e-mail ${email} j√° realizou um pedido hoje. Tente novamente em ${horasRestantes} horas.`);
                }
            }

            pedidos.push({
                ...currentItem,
                user,
                email,
                type,
                obs,
                status: 'Pendente',
                date: new Date().toLocaleString('pt-BR'),
                timestamp: agora
            });

            localStorage.setItem('meus_pedidos', JSON.stringify(pedidos));
            alert("Pedido enviado com sucesso!");
            
            document.getElementById('userName').value = "";
            document.getElementById('userEmail').value = "";
            document.getElementById('userObs').value = "";
            closeModal();
        }

        function renderAdminTable() {
            const pedidos = JSON.parse(localStorage.getItem('meus_pedidos') || '[]');
            const table = document.getElementById('admin-table');
            table.innerHTML = '';

            pedidos.forEach((p, index) => {
                const statusClass = p.status === 'Aceito' ? 'bg-green-100 text-green-700' : p.status === 'Recusado' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700';
                table.innerHTML += `
                    <tr>
                        <td class="p-4 flex items-center gap-3">
                            <img src="${p.img}" class="w-10 h-14 rounded object-cover shadow-sm">
                            <div>
                                <p class="font-bold text-sm leading-tight">${p.name}</p>
                                <span class="text-[10px] text-gray-400">${p.date}</span>
                            </div>
                        </td>
                        <td class="p-4">
                            <p class="text-sm font-bold">${p.user}</p>
                            <p class="text-[10px] text-gray-500">${p.email}</p>
                        </td>
                        <td class="p-4">
                            <p class="text-xs font-bold">${p.type}</p>
                            <p class="text-xs text-gray-500 italic max-w-xs">${p.obs || 'Sem obs'}</p>
                        </td>
                        <td class="p-4"><span class="px-3 py-1 rounded-full text-xs font-bold ${statusClass}">${p.status}</span></td>
                        <td class="p-4 text-center space-x-1 flex">
                            <button onclick="updateStatus(${index}, 'Aceito')" class="text-green-500 hover:bg-green-50 p-2 rounded-lg"><i class="fas fa-check"></i></button>
                            <button onclick="updateStatus(${index}, 'Recusado')" class="text-red-500 hover:bg-red-50 p-2 rounded-lg"><i class="fas fa-times"></i></button>
                            <button onclick="deleteItem(${index})" class="text-gray-400 hover:text-black p-2 rounded-lg"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
        }

        function updateStatus(index, status) {
            const pedidos = JSON.parse(localStorage.getItem('meus_pedidos'));
            pedidos[index].status = status;
            localStorage.setItem('meus_pedidos', JSON.stringify(pedidos));
            renderAdminTable();
        }

        function deleteItem(index) {
            if(confirm("Excluir este pedido?")) {
                const pedidos = JSON.parse(localStorage.getItem('meus_pedidos'));
                pedidos.splice(index, 1);
                localStorage.setItem('meus_pedidos', JSON.stringify(pedidos));
                renderAdminTable();
            }
        }

        function clearAll() {
            if(confirm("Deseja apagar TODOS os pedidos?")) {
                localStorage.removeItem('meus_pedidos');
                renderAdminTable();
            }
        }
    </script>
</body>
</html>